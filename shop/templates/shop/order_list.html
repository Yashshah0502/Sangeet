<!DOCTYPE html>
<html>
  <head>
    <title>Order Management | Sangeet by Gitika</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      th,
      td {
        vertical-align: middle !important;
      }
      .order-summary {
        background: #f8f9fa;
        border-top: 2px solid #dee2e6;
        position: sticky;
        bottom: 0;
        z-index: 10;
      }
      .navbar-brand {
        font-size: 1.3rem;
      }
      table img {
        object-fit: cover;
        border-radius: 6px;
      }
    </style>
  </head>

<body class="bg-light">
  <!-- TEMPLATE: shop/order_list.html -->
    
    <nav class="navbar navbar-dark bg-dark px-4">
      <a class="navbar-brand fw-bold text-white" href="/"
        >ðŸ‘œ Sangeet by Gitika</a
      >
      <div>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-light me-2"
          >Products</a
        >
        <a href="{% url 'order_list' %}" class="btn btn-success me-2">Orders</a>
        <a href="/accounts/logout/" class="btn btn-outline-light">Logout</a>
      </div>
    </nav>

    <div class="container py-4">
      <h2 class="text-center mb-4">ðŸ“¦ Order Management</h2>

      {% if messages %} {% for message in messages %}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %} {% endif %}

      <div class="table-responsive bg-white shadow-sm p-3 rounded">
        <table class="table table-striped align-middle text-center mb-0">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Product</th>
              <th>Photo</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Total</th>
              <th>Date</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>
                {% if order.order_id %}
                <span class="badge bg-secondary">{{ order.order_id }}</span>
                {% else %}
                <span class="badge bg-warning text-dark">Pending ID</span>
                {% endif %}
              </td>
              <td>
                <strong>{{ order.customer_name }}</strong><br />
                <small class="text-muted">{{ order.customer_email }}</small>
              </td>
              <td>{{ order.product.name }}</td>
              <td>
                {% if order.product.image %}
                <img
                  src="{{ order.product.image.url }}"
                  alt="{{ order.product.name }}"
                  width="60"
                  height="60"
                />
                {% else %}
                <img
                  src="https://via.placeholder.com/60x60?text=No+Image"
                  width="60"
                  height="60"
                />
                {% endif %}
              </td>
              <td>â‚¹{{ order.product.price|floatformat:2 }}</td>
              <td>{{ order.quantity }}</td>
              <td class="text-start">
                <strong>Subtotal:</strong> â‚¹{{ order.subtotal|floatformat:2
                }}<br />
                <span class="text-muted small"
                  >Tax (18%): â‚¹{{ order.tax|floatformat:2 }}</span
                ><br />
                <strong>Total:</strong>
                <span class="text-success fw-bold"
                  >â‚¹{{ order.total|floatformat:2 }}</span
                >
              </td>
              <td>{{ order.created_at|date:"M d, Y H:i" }}</td>
              <td>
                <a
                  href="{% url 'delete_order' order.id %}"
                  class="btn btn-sm btn-danger"
                  title="Delete Order"
                >
                  <i class="bi bi-trash"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="10" class="text-muted text-center py-3">
                No orders placed yet.
              </td>
            </tr>
            {% endfor %}
          </tbody>

          <!-- âœ… Revenue summary footer -->
          {% if orders %}
          <tfoot class="order-summary">
            <tr>
              <td colspan="7" class="text-end fw-bold">Total Tax Collected:</td>
              <td colspan="2" class="fw-semibold text-success">
                â‚¹{{ total_tax|floatformat:2 }}
              </td>
            </tr>
            <tr>
              <td colspan="7" class="text-end fw-bold">
                Total Revenue (incl. Tax):
              </td>
              <td colspan="2" class="fw-bold text-primary">
                â‚¹{{ total_revenue|floatformat:2 }}
              </td>
            </tr>
          </tfoot>
          {% endif %}
        </table>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>