{% extends 'shop/base.html' %}
{% block title %}Orders - Sangeet by Gitika{% endblock %}
{% block content %}

<div class="container py-4">
  <h2 class="text-center mb-4">ðŸ“¦ Order Management</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="table-responsive bg-white shadow-sm p-3 rounded">
    <table class="table table-striped align-middle text-center mb-0">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Product</th>
          <th>Photo</th>
          <th>Price</th>
          <th>Qty</th>
          <th>Total</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>
            {% if order.order_id %}
              <span class="badge bg-secondary">{{ order.order_id }}</span>
            {% else %}
              <span class="badge bg-warning text-dark">Pending ID</span>
            {% endif %}
          </td>
          <td>
            <strong>{{ order.customer_name }}</strong><br />
            <small class="text-muted">{{ order.customer_email }}</small>
          </td>
          <td>{{ order.product.name }}</td>
          <td>
            {% if order.product.image %}
              <img src="{{ order.product.image.url }}" alt="{{ order.product.name }}" width="60" height="60" />
            {% else %}
              <img src="https://via.placeholder.com/60x60?text=No+Image" width="60" height="60" />
            {% endif %}
          </td>
          <td>â‚¹{{ order.product.price|floatformat:2 }}</td>
          <td>{{ order.quantity }}</td>
          <td class="text-start">
            <strong>Subtotal:</strong> â‚¹{{ order.subtotal|floatformat:2 }}<br />
            <span class="text-muted small">Tax (18%): â‚¹{{ order.tax|floatformat:2 }}</span><br />
            <strong>Total:</strong> <span class="text-success fw-bold">â‚¹{{ order.total|floatformat:2 }}</span>
          </td>
          <td>{{ order.created_at|date:"M d, Y H:i" }}</td>
          <td>
            <!-- Delete Button triggers the modal -->
            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal{{ order.id }}">
              Delete
            </button>

            <!-- Modal -->
            <div class="modal fade" id="deleteModal{{ order.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ order.id }}" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel{{ order.id }}">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete Order #{{ order.id }}?
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <a href="{% url 'delete_order' order.id %}" class="btn btn-danger">Yes, Delete</a>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="text-muted text-center py-3">No orders placed yet.</td>
          </tr>
        {% endfor %}
      </tbody>

      {% if orders %}
      <tfoot class="order-summary">
        <tr>
          <td colspan="7" class="text-end fw-bold">Total Tax Collected:</td>
          <td colspan="2" class="fw-semibold text-success">â‚¹{{ total_tax|floatformat:2 }}</td>
        </tr>
        <tr>
          <td colspan="7" class="text-end fw-bold">Total Revenue (incl. Tax):</td>
          <td colspan="2" class="fw-bold text-primary">â‚¹{{ total_revenue|floatformat:2 }}</td>
        </tr>
      </tfoot>
      {% endif %}
    </table>
  </div>
</div>

{% endblock %}